<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="optic">
<title>Introduction to OPTIC • optic</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to OPTIC">
<meta property="og:description" content="optic">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">optic</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/intro_optic.html">Introduction to OPTIC</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/randcorporation/optic/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction to OPTIC</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/randcorporation/optic/blob/HEAD/vignettes/intro_optic.Rmd" class="external-link"><code>vignettes/intro_optic.Rmd</code></a></small>
      <div class="d-none name"><code>intro_optic.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 class="unnumbered" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette covers use of the OPTIC package (Opioid Policy Tools
and Information Center), which contains tools to simulate the
performance of commonly-used statistical models for panel data or
repeated measures data. Briefly, OPTIC uses Monte Carlo simulations to
estimate the performance of models typically used for state-level policy
evaluation (for example, differences-in-differences estimators). Package
users provide the simulation procedure with a policy evaluation
scenario, a hypothetical treatment effect, an estimator and model
specification, and simulation parameters. The OPTIC package then
constructs simulations for all chosen simulation parameters and
estimators, returning summary statistics on each simulation’s
performance.</p>
<p>Currently, OPTIC has been developed for policy evaluation scenarios
with the following assumptions:</p>
<ol style="list-style-type: decimal">
<li>
<strong>No confounding</strong> : There are no confounding variables
which determine a observation’s selection into treatment. Additionally,
treatment effects are assumed to be constant rather than
time-varying.</li>
<li>
<strong>Concurrent policies</strong>: There is one additional policy
which co-occurs with the the policy of-interest.</li>
</ol>
<p>Additional details on the simulation procedures within OPTIC are
available in Griffin et al., 2021<span class="citation"><sup>1</sup></span> and Griffin et al., 2022<span class="citation"><sup>2</sup></span>. Forthcoming updates to OPTIC will
provides simulations which test the effect of confounding bias on model
performance.</p>
<p>This README covers the use of OPTIC in R and provides examples of the
package’s features. Section one covers package installation, section two
provides a general overview of the package’s usage, and section three
provides two examples of the package under the different policy
scenarios described above.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>From an R session, install the package from CRAN with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"optic"</span><span class="op">)</span></span></code></pre></div>
<p>Or from github:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install remotes if necessary</span></span>
<span><span class="co"># install.packages("remotes")</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"RANDCorporation/optic"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="overview-of-the-optic-package">Overview of the OPTIC Package<a class="anchor" aria-label="anchor" href="#overview-of-the-optic-package"></a>
</h2>
<p>OPTIC contains two core functions for performing simulations, which
require four user-provided inputs. Figure 1 below displays a flowchart
of OPTIC’s required steps to produce simulation results.</p>
<center>
<img src="optic_flowchart.svg" style="width:90.0%">
</center>
<p>The following sections describe OPTIC inputs and steps in detail.</p>
<div class="section level3">
<h3 id="user-inputs">User inputs<a class="anchor" aria-label="anchor" href="#user-inputs"></a>
</h3>
<div class="section level4">
<h4 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h4>
<p>Analysts will need to shape their data to work properly with OPTIC.
The package contains an example dataset which demonstrates the format
required by the function <code>optic_simulation</code>.</p>
<table class="table">
<colgroup>
<col width="11%">
<col width="7%">
<col width="15%">
<col width="24%">
<col width="14%">
<col width="10%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="left">state</th>
<th align="right">year</th>
<th align="right">population</th>
<th align="right">unemploymentrate</th>
<th align="right">opioid_rx</th>
<th align="right">deaths</th>
<th align="right">crude.rate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Alabama</td>
<td align="right">1999</td>
<td align="right">4430141</td>
<td align="right">4.7</td>
<td align="right">NA</td>
<td align="right">169</td>
<td align="right">3.8</td>
</tr>
<tr class="even">
<td align="left">Alabama</td>
<td align="right">2000</td>
<td align="right">4447100</td>
<td align="right">4.6</td>
<td align="right">NA</td>
<td align="right">197</td>
<td align="right">4.4</td>
</tr>
<tr class="odd">
<td align="left">Alabama</td>
<td align="right">2001</td>
<td align="right">4467634</td>
<td align="right">5.1</td>
<td align="right">NA</td>
<td align="right">216</td>
<td align="right">4.8</td>
</tr>
<tr class="even">
<td align="left">Alaska</td>
<td align="right">1999</td>
<td align="right">624779</td>
<td align="right">6.5</td>
<td align="right">NA</td>
<td align="right">46</td>
<td align="right">7.4</td>
</tr>
<tr class="odd">
<td align="left">Alaska</td>
<td align="right">2000</td>
<td align="right">626932</td>
<td align="right">6.4</td>
<td align="right">NA</td>
<td align="right">48</td>
<td align="right">7.7</td>
</tr>
<tr class="even">
<td align="left">Alaska</td>
<td align="right">2001</td>
<td align="right">633714</td>
<td align="right">6.4</td>
<td align="right">NA</td>
<td align="right">62</td>
<td align="right">9.8</td>
</tr>
</tbody>
</table>
<p>The data should generally be structured to work as an input to a
two-way fixed effect model, using a “long-format”, with variables for
“group”, “time”, covariates, and an outcome variable. The example data
included in the package is derived from data provided by the US Bureau
of Labor Statistics and the Centers for Disease Control and
Prevention.</p>
</div>
<div class="section level4">
<h4 id="policy-evaluation-scenarios">Policy evaluation scenarios<a class="anchor" aria-label="anchor" href="#policy-evaluation-scenarios"></a>
</h4>
<p>Policy evaluation scenarios are single string inputs into the
<code>optic_simulation</code> function, representing either the no
confounding scenario (“noconf”) or the confounding due to co-occurring
policies scenario (“concurrent”). For the “concurrent” scenario, there
are additional parameters required by <code>optic_simulation</code>,
which are discussed in the “parameter” section below. Additional details
on policy evaluation scenarios are provided in Griffin et al., 2021<span class="citation"><sup>1</sup></span> and Griffin et al., 2022<span class="citation"><sup>2</sup></span>.</p>
</div>
<div class="section level4">
<h4 id="treatment-scenarios">Treatment scenarios<a class="anchor" aria-label="anchor" href="#treatment-scenarios"></a>
</h4>
<p>This input represents the “true treatment effects” that OPTIC will
simulate across model iterations. OPTIC is currently designed to work on
static treatment effects (rather than dynamic treatment effects, such as
time-varying treatment effects). Users should structure their treatment
scenarios in a list, corresponding to a change in the outcome variable.
The list will contain two effects within a vector, if the user is
simulating models for the “concurrent” policy evaluation scenario. Using
the example_data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">overdoses</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate 5% and 10% changes in mean opioid_death_rate, across states and years. </span></span>
<span><span class="va">five_percent_effect</span> <span class="op">&lt;-</span> <span class="fl">0.05</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">overdoses</span><span class="op">$</span><span class="va">crude.rate</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">ten_percent_effect</span>  <span class="op">&lt;-</span> <span class="fl">0.10</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">overdoses</span><span class="op">$</span><span class="va">crude.rate</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate a confounding policy effect</span></span>
<span><span class="va">confound_effect</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.02</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">overdoses</span><span class="op">$</span><span class="va">crude.rate</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Scenario object for "no confounding" evaluation scenario:</span></span>
<span><span class="va">scenarios_no_confounding</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">five_percent_effect</span>, <span class="va">ten_percent_effect</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Scenario object for "co-occuring policy" evaluation scenario:</span></span>
<span><span class="va">scenarios_co_occur</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">five_percent_effect</span>, <span class="va">confound_effect</span><span class="op">)</span>,</span>
<span>                           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ten_percent_effect</span>, <span class="va">confound_effect</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="optic-functions">OPTIC functions<a class="anchor" aria-label="anchor" href="#optic-functions"></a>
</h3>
<div class="section level4">
<h4 id="optic_model-and-optic_simulation">
<code>optic_model</code> and <code>optic_simulation</code><a class="anchor" aria-label="anchor" href="#optic_model-and-optic_simulation"></a>
</h4>
<p>For each treatment scenario, OPTIC will simulate a treatment effect
and then attempt to estimate this effect based on user-provided models.
The <code>optic_simulation</code> function takes a list of
<code>optic_model</code>. Model lists should contain
<code>optic_model</code> with the following arguments :</p>
<ul>
<li><p><code>name</code>: A name for the model to identify the model
type in results.</p></li>
<li>
<p><code>type</code>: Users can set this as either “autoreg”,
“drdid”, “multisynth”, or “reg”.</p>
<ul>
<li><p>“reg” uses a typical regression framework, implementing the
procedure chosen in <code>model_call</code>.</p></li>
<li><p>“autoreg” adds a dependent lag to the model formula.</p></li>
<li><p>“drdid” estimates a treatment effect using a doubly-robust
difference-in-difference estimator, with covariates in the
<code>model_formula</code> argument used within both the propensity
score stage and (for more details on doubly robust
difference-in-differences, see Sant’Anna \&amp; Zhao, 2020)</p></li>
<li><p>“multisynth” estimates a treatment effect using augmented
synthetic controls (for additional details on augmented synthetic
controls, see Ben-Michael, Feller, \&amp; Rothstein, 2021).</p></li>
</ul>
</li>
<li><p><code>call</code>: The call for the model in R (e.g. “lm”, “glm”,
etc).</p></li>
<li><p><code>formula</code>: The model specification, in an R formula.
Needs to include a variable labeled “treament_level” for treatment
status or labeled “treatment_change” for coding a change in treatment
status (e.g.  used in autoregressive models). For “concurrent”
scenarios, treatment variables should labeled “treatment1”,
“treatment2”, . . ., “treatment{n}” for each policy included.</p></li>
<li><p><code>args</code>: Any additional arguments passed to the
model_call (e.g. “weights”, “family”, “control” etc.).</p></li>
<li><p><code>se_adjust</code>: Any adjustments to standard errors after
estimation. OPTIC recognizes either “none” for no adjustment or
“cluster” for clustered standard errors (OPTIC will use the
<code>optic_simulation</code> parameter “unit_var” to determine clusters
for clustered standard errors).</p></li>
</ul>
<p>Below provides an example of a model list using the
<code>example_data</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Specify 3 models to simulate treatment effects: Linear fixed effect model,</span></span>
<span><span class="co"># with and without covariate adjusters, and a linear model using ar-terms</span></span>
<span><span class="co"># and no fixed-effects</span></span>
<span></span>
<span><span class="va">lm_fe_unadj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optic_model.html">optic_model</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"fixed_effect_linear"</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"reg"</span>,</span>
<span>    call <span class="op">=</span> <span class="st">"lm"</span>,</span>
<span>    formula <span class="op">=</span> <span class="va">crude.rate</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span> <span class="op">+</span> <span class="va">treatment_level</span>,</span>
<span>    se_adjust <span class="op">=</span> <span class="st">"cluster-unit"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">lm_fe_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optic_model.html">optic_model</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"fixed_effect_linear_adj"</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"reg"</span>,</span>
<span>    call <span class="op">=</span> <span class="st">"lm"</span>,</span>
<span>    formula <span class="op">=</span> <span class="va">crude.rate</span> <span class="op">~</span> <span class="va">unemploymentrate</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span> <span class="op">+</span> <span class="va">treatment_level</span>,</span>
<span>    se_adjust <span class="op">=</span> <span class="st">"cluster-unit"</span></span>
<span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">lm_ar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optic_model.html">optic_model</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"auto_regressive_linear"</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"autoreg"</span>,</span>
<span>    call <span class="op">=</span> <span class="st">"lm"</span>,</span>
<span>    formula <span class="op">=</span> <span class="va">crude.rate</span> <span class="op">~</span> <span class="va">unemploymentrate</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span> <span class="op">+</span> <span class="va">treatment_change</span>,</span>
<span>    se_adjust <span class="op">=</span> <span class="st">"cluster-unit"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">lm_fe_unadj</span>, <span class="va">lm_fe_adj</span>, <span class="va">lm_ar</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="optic_simulation">
<code>optic_simulation</code><a class="anchor" aria-label="anchor" href="#optic_simulation"></a>
</h4>
<p>This function takes the policy evaluation scenario, treatment
scenarios, model list, and function parameters to generate synthetic
datasets with simulated treatment effects. <code>optic_simulation</code>
has the following arguments:</p>
<ul>
<li><p><code>x</code>: The prepped analysis dataset. See section above
for more details.</p></li>
<li><p><code>models</code>: List of models. See section above for more
details.</p></li>
<li><p><code>method</code>: Policy evaluation scenario. Can either be
“noconf” or “concurrent”.</p></li>
<li><p><code>unit_var</code>: Variable for groups within the dataset.
Used to determine clusters for clustered standard errors</p></li>
<li><p><code>time_var</code>: The variable used for time units. Variable
should corresponding to years. To use alternative time units, express
them as fractional years (e.g. July = 7/12).</p></li>
<li><p><code>effect_magnitude</code>: A vector of treatment scenarios.
See section above for more details. Synthetic datasets will be generated
for each entry in the vector.</p></li>
<li><p><code>n_units</code>: A vector with the number of units to
simulate treatment. Synthetic datasets will be generated for each entry
in the vector.</p></li>
<li><p><code>effect_direction</code>: A vector containing either ‘neg’,
‘null’, or ‘pos’. Synthetic datasets will be generated for each entry in
the vector. Determines the direction of the simulated effect.</p></li>
<li><p><code>policy_speed</code>: A vector containing either ‘instant’
or ‘slow’ entries, determining how quickly treated units obtain the
simulated effect. Synthetic datasets will be generated for each entry in
the vector. Can either be ‘instant” (so treatment effect applies fully
in the first treated time period) or ’slow’ (treatment effect ramps up
linearly to the desired effect size, based on
<code>n_implementation_periods</code>.</p></li>
<li><p><code>n_implementation_periods</code> A numeric vector with
number of periods after implementation until treated units reach the
desired simulated treatment effect. Synthetic datasets will be generated
for each entry in the vector.</p></li>
</ul>
<p>Three arguments to <code>optic_simulation</code> only apply within
the “concurrent” policy scenario:</p>
<ul>
<li><p><code>rhos</code>: A vector of 0-1 values indicating the
correlation between the primary policy and a confounding policy.
Synthetic datasets will be generated for each entry in the
vector.</p></li>
<li><p><code>years_apart</code>: Number of years between the primary
policy being implemented and the confounding policy.</p></li>
<li><p><code>ordered</code>: Determines if the primary policy always
occurs before the confounding policy (<code>TRUE</code>) or if the
policies are randomly ordered (<code>FALSE</code>).</p></li>
</ul>
<p>The function returns a configuration object that’s used as an input
to <code>dispatch_simulations</code>. This object contains a dataset
listing all possible simulations that will be run for each model (. An
example call of <code>optic_simulation</code> is displayed below:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">sim_config</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optic_simulation.html">optic_simulation</a></span><span class="op">(</span></span>
<span>  </span>
<span>  x                        <span class="op">=</span> <span class="va">overdoses</span>,</span>
<span>  models                   <span class="op">=</span> <span class="va">sim_models</span>,</span>
<span>  iters                    <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  method                   <span class="op">=</span> <span class="st">"no_confounding"</span>,</span>
<span>  unit_var                 <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>  treat_var                <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>  time_var                 <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>  effect_magnitude         <span class="op">=</span> <span class="va">scenarios_no_confounding</span>,</span>
<span>  n_units                  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">40</span>, <span class="fl">50</span><span class="op">)</span>,</span>
<span>  effect_direction         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"neg"</span><span class="op">)</span>,</span>
<span>  policy_speed             <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"instant"</span><span class="op">)</span>,</span>
<span>  n_implementation_periods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Number of Simulations: 6</span></span>
<span><span class="co">#&gt; Number of Models: 3</span></span>
<span><span class="co">#&gt; Iteration per Simulation : 100</span></span>
<span><span class="co">#&gt; Total number of Iterations to Run: 1800</span></span></code></pre></div>
<p>In addition to the parameters discussed above, OPTIC also permits an
advanced user to override the internal functions of each model (such as
the sampling method for assigning treatment), by passing a custom
function to <code>optic_simulation</code>. We suggest referring to the
underlying functions within the scripts
<code>no-confounding-methods.R</code>,
<code>concurrent-methods.R</code>, and
<code>selection-bias-methods.R</code>, if further modifications are
desired.</p>
</div>
<div class="section level4">
<h4 id="dispatch_simulations">
<code>dispatch_simulations</code><a class="anchor" aria-label="anchor" href="#dispatch_simulations"></a>
</h4>
<p>With the configuration object built, we can now simulate models with
the configuration scenarios using the <code>simulate</code> function.
This function accepts arguments to parallelize code through the use of
the “future” package. If this setting is turned on, the function will
try to parallelize simulation iterations on the analyst’s machine. Any
additional packages required by the user for model calls (e.g. a
specific modeling package) must also be passed to dispatch_simulations
using future.globals and future.packages arguments.</p>
<p>Note this next step will only take a few minutes to run; with large
numbers of permutations or iterations, it can require several hours for
this function to finish. We suggest using the parallelization options
(<code>use_future = T</code>), which can help a great deal for large
analyses on your data of interest. We recommend using anywhere between
300-1000 iterations when analyzing your final sets of output.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dispatch_simulations.html">dispatch_simulations</a></span><span class="op">(</span></span>
<span>  </span>
<span>  <span class="va">sim_config</span>,</span>
<span>  use_future <span class="op">=</span> <span class="cn">T</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">9782</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  future.globals<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cluster_adjust_se"</span><span class="op">)</span>,</span>
<span>  future.packages<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MASS"</span>, <span class="st">"dplyr"</span>, <span class="st">"optic"</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; JOB 1 OF 6 DISPATCHED:</span></span>
<span><span class="co">#&gt;         DISPATCH METHOD: parallel (future)</span></span>
<span><span class="co">#&gt;         PARAMS:</span></span>
<span><span class="co">#&gt;             unit_var: state</span></span>
<span><span class="co">#&gt;             time_var: year</span></span>
<span><span class="co">#&gt;             effect_magnitude: 0.632536458333333</span></span>
<span><span class="co">#&gt;             n_units: 30</span></span>
<span><span class="co">#&gt;             effect_direction: neg</span></span>
<span><span class="co">#&gt;             policy_speed: instant</span></span>
<span><span class="co">#&gt;             n_implementation_periods: 1</span></span>
<span><span class="co">#&gt;             prior_control: level</span></span>
<span><span class="co">#&gt;             treat_var: state</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:MASS':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     select</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="co">#&gt; JOB 2 OF 6 DISPATCHED:</span></span>
<span><span class="co">#&gt;         DISPATCH METHOD: parallel (future)</span></span>
<span><span class="co">#&gt;         PARAMS:</span></span>
<span><span class="co">#&gt;             unit_var: state</span></span>
<span><span class="co">#&gt;             time_var: year</span></span>
<span><span class="co">#&gt;             effect_magnitude: 1.26507291666667</span></span>
<span><span class="co">#&gt;             n_units: 30</span></span>
<span><span class="co">#&gt;             effect_direction: neg</span></span>
<span><span class="co">#&gt;             policy_speed: instant</span></span>
<span><span class="co">#&gt;             n_implementation_periods: 1</span></span>
<span><span class="co">#&gt;             prior_control: level</span></span>
<span><span class="co">#&gt;             treat_var: state</span></span>
<span><span class="co">#&gt; JOB 3 OF 6 DISPATCHED:</span></span>
<span><span class="co">#&gt;         DISPATCH METHOD: parallel (future)</span></span>
<span><span class="co">#&gt;         PARAMS:</span></span>
<span><span class="co">#&gt;             unit_var: state</span></span>
<span><span class="co">#&gt;             time_var: year</span></span>
<span><span class="co">#&gt;             effect_magnitude: 0.632536458333333</span></span>
<span><span class="co">#&gt;             n_units: 40</span></span>
<span><span class="co">#&gt;             effect_direction: neg</span></span>
<span><span class="co">#&gt;             policy_speed: instant</span></span>
<span><span class="co">#&gt;             n_implementation_periods: 1</span></span>
<span><span class="co">#&gt;             prior_control: level</span></span>
<span><span class="co">#&gt;             treat_var: state</span></span>
<span><span class="co">#&gt; JOB 4 OF 6 DISPATCHED:</span></span>
<span><span class="co">#&gt;         DISPATCH METHOD: parallel (future)</span></span>
<span><span class="co">#&gt;         PARAMS:</span></span>
<span><span class="co">#&gt;             unit_var: state</span></span>
<span><span class="co">#&gt;             time_var: year</span></span>
<span><span class="co">#&gt;             effect_magnitude: 1.26507291666667</span></span>
<span><span class="co">#&gt;             n_units: 40</span></span>
<span><span class="co">#&gt;             effect_direction: neg</span></span>
<span><span class="co">#&gt;             policy_speed: instant</span></span>
<span><span class="co">#&gt;             n_implementation_periods: 1</span></span>
<span><span class="co">#&gt;             prior_control: level</span></span>
<span><span class="co">#&gt;             treat_var: state</span></span>
<span><span class="co">#&gt; JOB 5 OF 6 DISPATCHED:</span></span>
<span><span class="co">#&gt;         DISPATCH METHOD: parallel (future)</span></span>
<span><span class="co">#&gt;         PARAMS:</span></span>
<span><span class="co">#&gt;             unit_var: state</span></span>
<span><span class="co">#&gt;             time_var: year</span></span>
<span><span class="co">#&gt;             effect_magnitude: 0.632536458333333</span></span>
<span><span class="co">#&gt;             n_units: 50</span></span>
<span><span class="co">#&gt;             effect_direction: neg</span></span>
<span><span class="co">#&gt;             policy_speed: instant</span></span>
<span><span class="co">#&gt;             n_implementation_periods: 1</span></span>
<span><span class="co">#&gt;             prior_control: level</span></span>
<span><span class="co">#&gt;             treat_var: state</span></span>
<span><span class="co">#&gt; JOB 6 OF 6 DISPATCHED:</span></span>
<span><span class="co">#&gt;         DISPATCH METHOD: parallel (future)</span></span>
<span><span class="co">#&gt;         PARAMS:</span></span>
<span><span class="co">#&gt;             unit_var: state</span></span>
<span><span class="co">#&gt;             time_var: year</span></span>
<span><span class="co">#&gt;             effect_magnitude: 1.26507291666667</span></span>
<span><span class="co">#&gt;             n_units: 50</span></span>
<span><span class="co">#&gt;             effect_direction: neg</span></span>
<span><span class="co">#&gt;             policy_speed: instant</span></span>
<span><span class="co">#&gt;             n_implementation_periods: 1</span></span>
<span><span class="co">#&gt;             prior_control: level</span></span>
<span><span class="co">#&gt;             treat_var: state</span></span></code></pre></div>
<p>OPTIC will provide a short summary on the models being run if verbose
is set to 1 or 2. We now have results which can be used to construct
summary statistics and compare models for policy evaluation. Each
scenario will be saved as a list entry in the results object, with each
list entry containing a dataframe with rows for model results. Model
results return model point estimates &amp; standard errors for each
treatment variable (in the ‘noconf’ method, this variable would be
‘treatment’ and for the ’concurrent” method, this variable would be
treatment1 &amp; treatment2), along with policy scenario settings.</p>
<p>The results table includes the simulation run parameters, along with
estimates of the simulated treatment effect. The table below displays a
few select estimates from the large results table:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">6</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">]</span>, format <span class="op">=</span> <span class="st">"markdown"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="2%">
<col width="9%">
<col width="12%">
<col width="9%">
<col width="8%">
<col width="8%">
<col width="9%">
<col width="8%">
<col width="8%">
<col width="21%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="left">outcome</th>
<th align="left">se_adjustment</th>
<th align="right">estimate</th>
<th align="right">se</th>
<th align="right">variance</th>
<th align="right">t_stat</th>
<th align="right">p_value</th>
<th align="right">mse</th>
<th align="left">model_name</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2</td>
<td align="left">crude.rate</td>
<td align="left">cluster-unit</td>
<td align="right">-0.8347378</td>
<td align="right">0.7812159</td>
<td align="right">0.6102983</td>
<td align="right">-1.0685109</td>
<td align="right">0.2855798</td>
<td align="right">10.199926</td>
<td align="left">fixed_effect_linear</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="left">crude.rate</td>
<td align="left">cluster-unit</td>
<td align="right">-0.7610651</td>
<td align="right">0.7671034</td>
<td align="right">0.5884476</td>
<td align="right">-0.9921284</td>
<td align="right">0.3214048</td>
<td align="right">10.164138</td>
<td align="left">fixed_effect_linear_adj</td>
</tr>
<tr class="odd">
<td align="left">6</td>
<td align="left">crude.rate</td>
<td align="left">cluster-unit</td>
<td align="right">-0.2578759</td>
<td align="right">0.4850419</td>
<td align="right">0.2352657</td>
<td align="right">-0.5316569</td>
<td align="right">0.5951049</td>
<td align="right">4.006579</td>
<td align="left">auto_regressive_linear</td>
</tr>
</tbody>
</table>
<p>We can use the results table to analyze the relative performance of
models across data scenarios or create test statistics as needed for an
analysis. For example, we might be interested in comparingrelative bias
across the point estimates, in the scenario where the effect of policy
implementation is immediate and decreases the crude.rate by 5%:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Compare point estimates across models for the 5% change scenario, with instantaneous policy adoption:</span></span>
<span><span class="va">df_compare</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">se_adjustment</span> <span class="op">==</span> <span class="st">"cluster-unit"</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">true_est</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">five_percent_effect</span>, <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">grab_mean_and_se</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model_name</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">sim_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">df_compare</span><span class="op">[</span><span class="va">df_compare</span><span class="op">$</span><span class="va">model_name</span> <span class="op">==</span> <span class="va">model_name</span>,<span class="op">]</span><span class="op">$</span><span class="va">estimate</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="va">sim_se</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">df_compare</span><span class="op">[</span><span class="va">df_compare</span><span class="op">$</span><span class="va">model_name</span> <span class="op">==</span> <span class="va">model_name</span>,<span class="op">]</span><span class="op">$</span><span class="va">estimate</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">sim_mean</span>, <span class="st">" ("</span>, <span class="va">sim_se</span>, <span class="st">")"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"True effect size: "</span>, <span class="va">true_est</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "True effect size: -0.633"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"FE LM effect: "</span>, <span class="fu">grab_mean_and_se</span><span class="op">(</span><span class="st">'fixed_effect_linear'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "FE LM effect: -0.683 (0.976)"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"FE LM adjusted effect: "</span>, <span class="fu">grab_mean_and_se</span><span class="op">(</span><span class="st">'fixed_effect_linear_adj'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "FE LM adjusted effect: -0.685 (0.975)"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"AR LM effect: "</span>, <span class="fu">grab_mean_and_se</span><span class="op">(</span><span class="st">'auto_regressive_linear'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "AR LM effect: -0.621 (0.44)"</span></span></code></pre></div>
<p>From the above output, we can see all models are producing similar
estimates, across simulated point estimate draws. While all of these
models are biased slightly downwards compared to the true effect, the
autoregressive linear model seems to outperform both the unadjusted and
adjusted fixed effect model, producing an estimate slightly closer to
truth, with greater precision. Based on this simulation, if these were
the only models under consideration, these results could justify using
an autoregressive linear model for analyzing the real policy effect.</p>
</div>
<div class="section level4">
<h4 id="acknowledgements">Acknowledgements<a class="anchor" aria-label="anchor" href="#acknowledgements"></a>
</h4>
<p>This package was financially supported through a National Institutes
of Health (NIH) grant (P50DA046351) to RAND (PI: Stein).</p>
</div>
</div>
<div class="section level3">
<h3 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<div id="refs" class="references csl-bib-body">
<div id="ref-http://zotero.org/users/3390799/items/ZNCVTPJF" class="csl-entry">
<div class="csl-left-margin">1 </div>
<div class="csl-right-inline">Griffin BA, Schuler MS, Stuart EA, <em>et
al.</em> <a href="https://doi.org/10.1186/s12874-021-01471-y" class="external-link">Moving
beyond the classic difference-in-differences model: a simulation study
comparing statistical methods for estimating effectiveness of
state-level policies</a>. <em>BMC Medical Research Methodology</em>
2021; <strong>21</strong>: 279.</div>
</div>
<div id="ref-http://zotero.org/users/3390799/items/V3Q6ARUA" class="csl-entry">
<div class="csl-left-margin">2 </div>
<div class="csl-right-inline">Griffin BA, Schuler MS, Pane J, <em>et al.</em>
Methodological considerations for estimating policy effects in the
context of co-occurring policies. <em>Health Serv Outcomes Res
Method</em> 2022; published online July 9. DOI:<a href="https://doi.org/10.1007/s10742-022-00284-w" class="external-link">10.1007/s10742-022-00284-w</a>.</div>
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Beth Ann Griffin, Pedro Nascimento de Lima, Max Griswold, Adam Scherling, Joseph Pane, Geoffrey Grimm.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
