<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to OPTIC • optic</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to OPTIC">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">optic</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/intro_optic.html">Introduction to OPTIC</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/randcorporation/optic/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to OPTIC</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/randcorporation/optic/blob/v1.1.3/vignettes/intro_optic.Rmd" class="external-link"><code>vignettes/intro_optic.Rmd</code></a></small>
      <div class="d-none name"><code>intro_optic.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 class="unnumbered" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette covers the use of the Opioid Policy Tools and
Information Center (OPTIC) simulation package, which contains tools to
simulate treatment effects into panel data or repeated measures data and
examine the performance of commonly-used statistical models. Briefly,
OPTIC uses Monte Carlo simulations to estimate the performance of models
typically used for state-level policy evaluation (for example,
differences-in-differences estimators). Package users provide the
simulation procedure with a policy evaluation scenario, a hypothetical
treatment effect, an estimation approach, and simulation parameters. The
OPTIC package then constructs simulations for all chosen simulation
parameters and estimators, returning summary statistics on each
simulation’s performance.</p>
<p>Currently, OPTIC has been developed for policy evaluation scenarios
with the following assumptions:</p>
<ol style="list-style-type: decimal">
<li>
<strong>No confounding</strong> : There are no confounding variables
which determine an observations’s selection into treatment. Treatment
effects are assumed to be constant rather than time-varying.</li>
<li>
<strong>Concurrent policies</strong>: There is one additional policy
which co-occurs with the policy of-interest.</li>
<li>
<strong>Confounding</strong>: There is a confounding variable
associated with both policy adoption and outcome <em>trends</em>.</li>
</ol>
<p>Additional details on the simulation procedures within the OPTIC
package are available in <span class="citation">Griffin et al.
(2021)</span> and <span class="citation">Griffin et al. (2023)</span>.
Forthcoming updates to OPTIC will provides simulations which test the
effect of confounding bias on model performance.</p>
<p>This README covers the use of OPTIC in R and provides examples of the
package’s features. Section one covers package installation, section two
provides a general overview of the package’s usage, and section three
provides two examples of the package under the different policy
scenarios described above.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>From an R session, install the package from CRAN with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"optic"</span><span class="op">)</span></span></code></pre></div>
<p>Or from github:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install remotes if necessary</span></span>
<span><span class="co"># install.packages("remotes")</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"RANDCorporation/optic"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="overview-of-the-optic-package">Overview of the OPTIC Package<a class="anchor" aria-label="anchor" href="#overview-of-the-optic-package"></a>
</h2>
<p>OPTIC contains two core functions for performing simulations, which
require four user-provided inputs. Figure 1 below displays a flowchart
of OPTIC’s required steps to produce simulation results.</p>
<center>
<img src="optic_flowchart.svg" style="width:90.0%">
</center>
<p>The following sections describe OPTIC inputs and steps in detail.</p>
<div class="section level3">
<h3 id="user-inputs">User inputs<a class="anchor" aria-label="anchor" href="#user-inputs"></a>
</h3>
<div class="section level4">
<h4 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h4>
<p>Analysts will need to shape their data to work properly with OPTIC.
The package contains an example dataset which demonstrates the format
required by the function <code>optic_simulation</code>.</p>
<table class="table">
<colgroup>
<col width="11%">
<col width="7%">
<col width="15%">
<col width="24%">
<col width="14%">
<col width="10%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="left">state</th>
<th align="right">year</th>
<th align="right">population</th>
<th align="right">unemploymentrate</th>
<th align="right">opioid_rx</th>
<th align="right">deaths</th>
<th align="right">crude.rate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Alabama</td>
<td align="right">1999</td>
<td align="right">4430141</td>
<td align="right">4.7</td>
<td align="right">NA</td>
<td align="right">169</td>
<td align="right">3.8</td>
</tr>
<tr class="even">
<td align="left">Alabama</td>
<td align="right">2000</td>
<td align="right">4447100</td>
<td align="right">4.6</td>
<td align="right">NA</td>
<td align="right">197</td>
<td align="right">4.4</td>
</tr>
<tr class="odd">
<td align="left">Alabama</td>
<td align="right">2001</td>
<td align="right">4467634</td>
<td align="right">5.1</td>
<td align="right">NA</td>
<td align="right">216</td>
<td align="right">4.8</td>
</tr>
<tr class="even">
<td align="left">Alaska</td>
<td align="right">1999</td>
<td align="right">624779</td>
<td align="right">6.5</td>
<td align="right">NA</td>
<td align="right">46</td>
<td align="right">7.4</td>
</tr>
<tr class="odd">
<td align="left">Alaska</td>
<td align="right">2000</td>
<td align="right">626932</td>
<td align="right">6.4</td>
<td align="right">NA</td>
<td align="right">48</td>
<td align="right">7.7</td>
</tr>
<tr class="even">
<td align="left">Alaska</td>
<td align="right">2001</td>
<td align="right">633714</td>
<td align="right">6.4</td>
<td align="right">NA</td>
<td align="right">62</td>
<td align="right">9.8</td>
</tr>
</tbody>
</table>
<p>The data should generally be structured to work as an input to a
two-way fixed effect model, using a “long-format”, with variables for
“group”, “time”, covariates, and an outcome variable. The example data
included in the package is derived from data provided by the US Bureau
of Labor Statistics and the Centers for Disease Control and
Prevention.</p>
</div>
<div class="section level4">
<h4 id="policy-evaluation-scenarios">Policy evaluation scenarios<a class="anchor" aria-label="anchor" href="#policy-evaluation-scenarios"></a>
</h4>
<p>Policy evaluation scenarios are single string inputs into the
<code>optic_simulation</code> function, representing either the no
confounding scenario (“noconf”) or co-occurring policies scenario
(“concurrent”). For the “concurrent” scenario, there are additional
parameters required by <code>optic_simulation</code>, which are
discussed in the “parameter” section below. Additional details on policy
evaluation scenarios are provided in <span class="citation">Griffin et
al. (2021)</span> and <span class="citation">Griffin et al.
(2023)</span>.</p>
</div>
<div class="section level4">
<h4 id="treatment-scenarios">Treatment scenarios<a class="anchor" aria-label="anchor" href="#treatment-scenarios"></a>
</h4>
<p>This input represents the “true treatment effects” that OPTIC will
simulate across each iteration of the simulations. OPTIC is currently
designed to work by generating static treatment effects (rather than
dynamic treatment effects, such as time-varying treatment effects).
Users should structure their treatment scenarios in a list,
corresponding to the different types of treatment effects they would
like to see examined. If the user is simulating models for the
‘concurrent’ policy evaluation scenario, the list will contain two
effects within a vector for each potential treatment scenario that the
user wants to examine. Using the example_data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">overdoses</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate a hypothetical 5% and 10% changes in mean opioid_death_rate, </span></span>
<span><span class="co"># across states and years. </span></span>
<span><span class="va">five_percent_effect</span> <span class="op">&lt;-</span> <span class="fl">0.05</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">overdoses</span><span class="op">$</span><span class="va">crude.rate</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">ten_percent_effect</span>  <span class="op">&lt;-</span> <span class="fl">0.10</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">overdoses</span><span class="op">$</span><span class="va">crude.rate</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Scenario object for "no confounding" evaluation scenario:</span></span>
<span><span class="va">scenarios_no_confounding</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">five_percent_effect</span>, <span class="va">ten_percent_effect</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate a co-occuring policy effect</span></span>
<span><span class="va">cooccur_effect</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.02</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">overdoses</span><span class="op">$</span><span class="va">crude.rate</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Scenario object for "co-occuring policy" evaluation scenario:</span></span>
<span><span class="va">scenarios_co_occur</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">five_percent_effect</span>, <span class="va">cooccur_effect</span><span class="op">)</span>,</span>
<span>                           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ten_percent_effect</span>, <span class="va">cooccur_effect</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="optic-functions">OPTIC functions<a class="anchor" aria-label="anchor" href="#optic-functions"></a>
</h3>
<div class="section level4">
<h4 id="optic_model-and-optic_simulation">
<code>optic_model</code> and <code>optic_simulation</code><a class="anchor" aria-label="anchor" href="#optic_model-and-optic_simulation"></a>
</h4>
<p>For each treatment scenario, OPTIC will simulate the specified
treatment effect onto the users repeated measures data and then attempt
to estimate this effect based on user-provided models. The
<code>optic_simulation</code> function takes a list of
<code>optic_model</code>. Model lists should contain
<code>optic_model</code> with the following arguments :</p>
<ul>
<li><p><code>name</code>: A name for the model to identify the model
type in results.</p></li>
<li>
<p><code>type</code>: Users can set this as either “autoreg”, “did”,
“multisynth”, or “reg”.</p>
<ul>
<li><p>“reg” uses a typical regression framework, implementing the
procedure chosen in <code>model_call</code>.</p></li>
<li><p>“autoreg” adds a dependent lag to the model formula.</p></li>
<li><p>“did” estimates a treatment effect using a doubly-robust
difference-in-difference estimator, with covariates in the
<code>model_formula</code> argument used within both the propensity
score stage and outcome modeling stage (for more details on doubly
robust difference-in-differences, see Sant’Anna \&amp; Zhao,
2020)</p></li>
<li><p>“multisynth” estimates a treatment effect using augmented
synthetic controls (for additional details on augmented synthetic
controls, see Ben-Michael, Feller, \&amp; Rothstein, 2021).</p></li>
</ul>
</li>
<li><p><code>call</code>: The call for the model in R (e.g. “lm”, “glm”,
etc).</p></li>
<li><p><code>formula</code>: The model specification, in an R formula.
Needs to include a variable labeled “treament_level” for treatment
status or labeled “treatment_change” for coding a change in treatment
status (when using autoregressive models). For “concurrent” scenarios,
treatment variables should labeled “treatment1” and “treatment2” for
each policy included.</p></li>
<li><p><code>args</code>: Any additional arguments passed to the
model_call (e.g. “weights”, “family”, “control” etc.).</p></li>
<li><p><code>se_adjust</code>: Any adjustments to standard errors after
estimation. OPTIC recognizes either “none” for no adjustment or
“cluster” for clustered standard errors (OPTIC will use the
<code>optic_simulation</code> parameter “unit_var” to determine clusters
for clustered standard errors).</p></li>
</ul>
<p>Below provides an example of a model list using the
<code>example_data</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Specify 3 models to simulate treatment effects: Linear fixed effect model,</span></span>
<span><span class="co"># with and without covariate adjusters, and a linear model using ar-terms</span></span>
<span><span class="co"># and no fixed-effects</span></span>
<span></span>
<span><span class="va">lm_fe_unadj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optic_model.html">optic_model</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"fixed_effect_linear"</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"reg"</span>,</span>
<span>    call <span class="op">=</span> <span class="st">"lm"</span>,</span>
<span>    formula <span class="op">=</span> <span class="va">crude.rate</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span> <span class="op">+</span> <span class="va">treatment_level</span>,</span>
<span>    se_adjust <span class="op">=</span> <span class="st">"cluster-unit"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">lm_fe_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optic_model.html">optic_model</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"fixed_effect_linear_adj"</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"reg"</span>,</span>
<span>    call <span class="op">=</span> <span class="st">"lm"</span>,</span>
<span>    formula <span class="op">=</span> <span class="va">crude.rate</span> <span class="op">~</span> <span class="va">unemploymentrate</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span> <span class="op">+</span> <span class="va">treatment_level</span>,</span>
<span>    se_adjust <span class="op">=</span> <span class="st">"cluster-unit"</span></span>
<span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">lm_ar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optic_model.html">optic_model</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"auto_regressive_linear"</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"autoreg"</span>,</span>
<span>    call <span class="op">=</span> <span class="st">"lm"</span>,</span>
<span>    formula <span class="op">=</span> <span class="va">crude.rate</span> <span class="op">~</span> <span class="va">unemploymentrate</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">+</span> <span class="va">treatment_change</span>,</span>
<span>    se_adjust <span class="op">=</span> <span class="st">"none"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">lm_fe_unadj</span>, <span class="va">lm_fe_adj</span>, <span class="va">lm_ar</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="optic_simulation">
<code>optic_simulation</code><a class="anchor" aria-label="anchor" href="#optic_simulation"></a>
</h4>
<p>This function takes the policy evaluation scenario, treatment
scenarios, model list, and function parameters to generate synthetic
datasets with simulated treatment effects. <code>optic_simulation</code>
has the following arguments:</p>
<ul>
<li><p><code>x</code>: The prepped analysis dataset. See section above
for more details.</p></li>
<li><p><code>models</code>: List of models. See section above for more
details.</p></li>
<li><p><code>method</code>: Policy evaluation scenario. Can either be
“noconf” or “concurrent”.</p></li>
<li><p><code>unit_var</code>: Variable for groups within the dataset.
Used to determine clusters for clustered standard errors</p></li>
<li><p><code>time_var</code>: The variable used for time units. Variable
should correspond to years. To use alternative time units, express them
as fractional years (e.g. July = 7/12).</p></li>
<li><p><code>effect_magnitude</code>: A vector of treatment scenarios.
See section above for more details. Synthetic datasets will be generated
for each entry in the vector.</p></li>
<li><p><code>n_units</code>: A vector with the number of units that
should be in the treatment group. Synthetic datasets will be generated
for each entry in the vector.</p></li>
<li><p><code>effect_direction</code>: A vector containing either ‘neg’,
‘null’, or ‘pos’. Synthetic datasets will be generated for each entry in
the vector. Determines the direction of the simulated effect.</p></li>
<li><p><code>policy_speed</code>: A vector containing either ‘instant’
or ‘slow’ entries, determining how quickly treated units obtain the
simulated effect. Synthetic datasets will be generated for each entry in
the vector. Can either be ‘instant” (so treatment effect applies fully
in the first treated time period) or ’slow’ (treatment effect ramps up
linearly to the desired effect size, based on
<code>n_implementation_periods</code>.</p></li>
<li><p><code>n_implementation_periods</code> A numeric vector with
number of periods after implementation until treated units reach the
desired simulated treatment effect. Synthetic datasets will be generated
for each entry in the vector.</p></li>
</ul>
<p>Three additional arguments to <code>optic_simulation</code> only
apply within the “concurrent” policy scenario:</p>
<ul>
<li><p><code>rhos</code>: A vector of 0-1 values indicating the
correlation between the primary policy and a cooccuring policy.
Synthetic datasets will be generated for each entry in the
vector.</p></li>
<li><p><code>years_apart</code>: Number of years between the primary
policy being implemented and the cooccuring policy.</p></li>
<li><p><code>ordered</code>: Determines if the primary policy always
occurs before the confounding policy (<code>TRUE</code>) or if the
policies are randomly ordered (<code>FALSE</code>).</p></li>
</ul>
<p>and four other arguments apply only to the “confounding” policy
scenario:</p>
<ul>
<li><p><code>conf_var</code>: A string variable, defining a (unobserved)
confounding variable in the dataset that will be used to simulate the
effect of confounding in the outcome variable.</p></li>
<li><p><code>prior_control</code>: A string variable that is either
“level” or “trend”. Specifies confounding for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>i</mi></msub><mi>j</mi></mrow><annotation encoding="application/x-tex">C_ij</annotation></semantics></math>
term, which is confounding due to either prior outcome levels or prior
outcome trends. For trends, OPTIC simulates confounding as an average of
outcome levels in the previous three years.</p></li>
<li><p><code>bias_type</code>: String determining type of confounding
effect, either ‘linear’ or ‘nonlinear’. If linear is chosen, then
confounding in the outcome is simulated as additive (unobserved confound
variable + prior outcome trend/level). If non-linear, then confounding
is simulated as additive, along with squared confounding terms and an
interaction term between the two confounders (unobserved variable and
prior outcome level/trends).</p></li>
<li><p><code>bias_size</code>: A string that is either ‘small’,
‘medium’, or ‘large’. Used to determine the level of confounding (see
paper for more details; this parameter sets values for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>a</mi><mi>i</mi></msub><annotation encoding="application/x-tex">a_i</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>b</mi><mi>i</mi></msub><annotation encoding="application/x-tex">b_i</annotation></semantics></math>
terms). The terms are determined such that the standardized mean
difference between simulated outcomes between treated units in
policy-enacted years and simulated outcomes for non-treated
units/treated units in non-policy enacted years is 0.15, 0.30, and 0.45
(for ‘small’, ‘medium’, and ‘large’, respectively).</p></li>
</ul>
<p>The function returns a configuration object that’s used as an input
to <code>dispatch_simulations</code>. This object contains a dataset
listing all possible simulations that will be run for each model. An
example call of <code>optic_simulation</code> is displayed below:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">sim_config</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optic_simulation.html">optic_simulation</a></span><span class="op">(</span></span>
<span></span>
<span>  x                        <span class="op">=</span> <span class="va">overdoses</span>,</span>
<span>  models                   <span class="op">=</span> <span class="va">sim_models</span>,</span>
<span>  iters                    <span class="op">=</span> <span class="fl">10</span>, <span class="co"># for real-world applications, we use 1000 iterations</span></span>
<span>  method                   <span class="op">=</span> <span class="st">"no_confounding"</span>,</span>
<span>  unit_var                 <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>  treat_var                <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>  time_var                 <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>  effect_magnitude         <span class="op">=</span> <span class="va">scenarios_no_confounding</span>,</span>
<span>  n_units                  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">40</span>, <span class="fl">50</span><span class="op">)</span>,</span>
<span>  effect_direction         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"neg"</span><span class="op">)</span>,</span>
<span>  policy_speed             <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"instant"</span><span class="op">)</span>,</span>
<span>  n_implementation_periods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Number of Simulations: 6</span></span>
<span><span class="co">#&gt; Number of Models: 3</span></span>
<span><span class="co">#&gt; Iteration per Simulation : 10</span></span>
<span><span class="co">#&gt; Total number of Iterations to Run: 180</span></span></code></pre></div>
<p>In addition to the parameters discussed above, OPTIC also permits an
advanced user to override the internal functions of each model (such as
the sampling method for assigning treatment), by passing a custom
function to <code>optic_simulation</code>. We suggest referring to the
underlying functions within the scripts
<code>no-confounding-methods.R</code>,
<code>concurrent-methods.R</code>, and
<code>selection-bias-methods.R</code>, if further modifications are
desired.</p>
</div>
<div class="section level4">
<h4 id="dispatch_simulations">
<code>dispatch_simulations</code><a class="anchor" aria-label="anchor" href="#dispatch_simulations"></a>
</h4>
<p>With the configuration object built, we can now simulate models with
the configuration scenarios using the <code>simulate</code> function.
This function accepts arguments to parallelize code through the use of
the “future” package. If this setting is turned on, the function will
try to parallelize simulation iterations on the analyst’s machine. Any
additional packages required by the user for model calls (e.g. a
specific modeling package) must also be passed to dispatch_simulations
using future.globals and future.packages arguments.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dispatch_simulations.html">dispatch_simulations</a></span><span class="op">(</span></span>
<span>  </span>
<span>  <span class="va">sim_config</span>,</span>
<span>  use_future <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">9782</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  future.globals<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cluster_adjust_se"</span><span class="op">)</span>,</span>
<span>  future.packages<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MASS"</span>, <span class="st">"dplyr"</span>, <span class="st">"optic"</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; TOTAL RUNS: 60 </span></span>
<span><span class="co">#&gt; SIMULATION SCENARIOS: 6 </span></span>
<span><span class="co">#&gt; ITERATIONS PER SCENARIO: 10 </span></span>
<span><span class="co">#&gt; DISPATCH METHOD: single-threaded</span></span></code></pre></div>
<p>OPTIC will provide a short summary on the models being run if verbose
is set to 1 or 2. We now have results which can be used to construct
summary statistics and compare models for policy evaluation. The results
object is a dataframe with rows for model results from each simulation
iteration and scenario. Model results return model point estimates &amp;
standard errors for each treatment variable (in the ‘noconf’ method,
this variable would be ‘treatment’ and for the ’concurrent” method, this
variable would be treatment1 &amp; treatment2), along with policy
scenario settings.</p>
<p>The results table includes the simulation run parameters, along with
estimates of the simulated treatment effect. The table below displays a
few select estimates from the large results table:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">6</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">]</span>, format <span class="op">=</span> <span class="st">"markdown"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="2%">
<col width="9%">
<col width="12%">
<col width="9%">
<col width="8%">
<col width="8%">
<col width="9%">
<col width="8%">
<col width="7%">
<col width="21%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="left">outcome</th>
<th align="left">se_adjustment</th>
<th align="right">estimate</th>
<th align="right">se</th>
<th align="right">variance</th>
<th align="right">t_stat</th>
<th align="right">p_value</th>
<th align="right">mse</th>
<th align="left">model_name</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2</td>
<td align="left">crude.rate</td>
<td align="left">cluster-unit</td>
<td align="right">0.4484649</td>
<td align="right">0.8253356</td>
<td align="right">0.6811788</td>
<td align="right">0.5433728</td>
<td align="right">0.5870092</td>
<td align="right">10.11952</td>
<td align="left">fixed_effect_linear</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="left">crude.rate</td>
<td align="left">cluster-unit</td>
<td align="right">0.4359681</td>
<td align="right">0.8084088</td>
<td align="right">0.6535247</td>
<td align="right">0.5392916</td>
<td align="right">0.5898207</td>
<td align="right">10.08406</td>
<td align="left">fixed_effect_linear_adj</td>
</tr>
<tr class="odd">
<td align="left">6</td>
<td align="left">crude.rate</td>
<td align="left">none</td>
<td align="right">-0.6021976</td>
<td align="right">0.4020783</td>
<td align="right">0.1616669</td>
<td align="right">-1.4977124</td>
<td align="right">0.1345625</td>
<td align="right">10.20254</td>
<td align="left">fixed_effect_linear</td>
</tr>
</tbody>
</table>
<p>There is also detailed information on Type I error rates when the
estimated treatment effect is null, Type S error rates, and
coverage.</p>
<p>We can use the results table to analyze the relative performance of
models across data scenarios or create test statistics as needed for an
analysis. For example, we might be interested in comparing relative bias
across the point estimates, in the scenario where the effect of policy
implementation is immediate and decreases the crude.rate by 5%:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Compare point estimates across models for the 5% change scenario, with instantaneous policy adoption:</span></span>
<span><span class="va">df_compare</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[</span><span class="va">results</span><span class="op">$</span><span class="va">effect_magnitude</span> <span class="op">==</span> <span class="va">five_percent_effect</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">true_est</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">five_percent_effect</span>, <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">grab_mean_and_se</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model_name</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">sim_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">df_compare</span><span class="op">[</span><span class="va">df_compare</span><span class="op">$</span><span class="va">model_name</span> <span class="op">==</span> <span class="va">model_name</span>,<span class="op">]</span><span class="op">$</span><span class="va">estimate</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="va">sim_se</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">df_compare</span><span class="op">[</span><span class="va">df_compare</span><span class="op">$</span><span class="va">model_name</span> <span class="op">==</span> <span class="va">model_name</span>,<span class="op">]</span><span class="op">$</span><span class="va">estimate</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">sim_mean</span>, <span class="st">" ("</span>, <span class="va">sim_se</span>, <span class="st">")"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"True effect size: "</span>, <span class="va">true_est</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "True effect size: -0.633"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"FE LM effect: "</span>, <span class="fu">grab_mean_and_se</span><span class="op">(</span><span class="st">'fixed_effect_linear'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "FE LM effect: -0.559 (0.808)"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"FE LM adjusted effect: "</span>, <span class="fu">grab_mean_and_se</span><span class="op">(</span><span class="st">'fixed_effect_linear_adj'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "FE LM adjusted effect: -0.575 (0.822)"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"AR LM effect: "</span>, <span class="fu">grab_mean_and_se</span><span class="op">(</span><span class="st">'auto_regressive_linear'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "AR LM effect: -0.595 (0.44)"</span></span></code></pre></div>
<p>From the above output, we can see all models are producing similar
estimates, across simulated point estimate draws. While all of these
models produced estimates which are closer to zero than the true effect,
the linear model seems to outperform both the unadjusted and
autoregressive model, producing an estimate closer to truth. Based on
this simulation, if these were the only models under consideration,
these results could justify using a unadjusted linear model for
analyzing the real policy effect.</p>
</div>
<div class="section level4">
<h4 id="acknowledgements">Acknowledgements<a class="anchor" aria-label="anchor" href="#acknowledgements"></a>
</h4>
<p>This package was financially supported through a National Institutes
of Health (NIH) grant (P50DA046351) to RAND (PI: Stein).</p>
</div>
</div>
<div class="section level3">
<h3 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-griffinMethodologicalConsiderationsEstimating2023" class="csl-entry">
Griffin, Beth Ann, Megan S. Schuler, Joseph Pane, Stephen W. Patrick,
Rosanna Smart, Bradley D. Stein, Geoffrey Grimm, and Elizabeth A.
Stuart. 2023. <span>“Methodological Considerations for Estimating Policy
Effects in the Context of Co-Occurring Policies.”</span> <em>Health
Services and Outcomes Research Methodology</em>, June. <a href="https://doi.org/10.1007/s10742-022-00284-w" class="external-link">https://doi.org/10.1007/s10742-022-00284-w</a>.
</div>
<div id="ref-griffinMovingClassicDifferenceindifferences2021" class="csl-entry">
Griffin, Beth Ann, Megan S. Schuler, Elizabeth A. Stuart, Stephen
Patrick, Elizabeth McNeer, Rosanna Smart, David Powell, Bradley D.
Stein, Terry L. Schell, and Rosalie Liccardo Pacula. 2021. <span>“Moving
Beyond the Classic Difference-in-Differences Model: A Simulation Study
Comparing Statistical Methods for Estimating Effectiveness of
State-Level Policies.”</span> <em>BMC Medical Research Methodology</em>
21 (1): 279. <a href="https://doi.org/10.1186/s12874-021-01471-y" class="external-link">https://doi.org/10.1186/s12874-021-01471-y</a>.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Beth Ann Griffin, Pedro Nascimento de Lima, Max Griswold, Adam Scherling, Joseph Pane, Geoffrey Grimm.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
