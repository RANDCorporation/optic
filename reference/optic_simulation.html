<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create a configuration object used to run simulations — optic_simulation • optic</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create a configuration object used to run simulations — optic_simulation"><meta name="description" content="Performs validation on inputs and produces a configuration object
    that contains all required parameters to dispatch simulation runs for the empirical data
    provided."><meta property="og:description" content="Performs validation on inputs and produces a configuration object
    that contains all required parameters to dispatch simulation runs for the empirical data
    provided."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">optic</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/intro_optic.html">Introduction to OPTIC</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/randcorporation/optic/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Create a configuration object used to run simulations</h1>
      <small class="dont-index">Source: <a href="https://github.com/randcorporation/optic/blob/main/R/optic-simulation-helper.R" class="external-link"><code>R/optic-simulation-helper.R</code></a></small>
      <div class="d-none name"><code>optic_simulation.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Performs validation on inputs and produces a configuration object
    that contains all required parameters to dispatch simulation runs for the empirical data
    provided.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">optic_simulation</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">models</span>,</span>
<span>  <span class="va">iters</span>,</span>
<span>  <span class="va">unit_var</span>,</span>
<span>  <span class="va">time_var</span>,</span>
<span>  <span class="va">conf_var</span>,</span>
<span>  <span class="va">effect_magnitude</span>,</span>
<span>  <span class="va">n_units</span>,</span>
<span>  <span class="va">effect_direction</span>,</span>
<span>  <span class="va">policy_speed</span>,</span>
<span>  prior_control <span class="op">=</span> <span class="st">"level"</span>,</span>
<span>  bias_size <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bias_type <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  treat_var <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">n_implementation_periods</span>,</span>
<span>  rhos <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  years_apart <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ordered <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">method</span>,</span>
<span>  <span class="va">method_sample</span>,</span>
<span>  <span class="va">method_model</span>,</span>
<span>  <span class="va">method_results</span>,</span>
<span>  <span class="va">method_pre_model</span>,</span>
<span>  <span class="va">method_post_model</span>,</span>
<span>  globals <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>Empirical data used to simulate synthetic datasets with specified treatment effect.</p></dd>


<dt id="arg-models">models<a class="anchor" aria-label="anchor" href="#arg-models"></a></dt>
<dd><p>List of `optic_model` objects that should be run for each iteration and simulation scenario.
The elements must be created using the `optic_model` function.</p></dd>


<dt id="arg-iters">iters<a class="anchor" aria-label="anchor" href="#arg-iters"></a></dt>
<dd><p>A numeric, specifying number of iterations for each simulation scenario.</p></dd>


<dt id="arg-unit-var">unit_var<a class="anchor" aria-label="anchor" href="#arg-unit-var"></a></dt>
<dd><p>A string variable, used to determine clusters for clustered standard errors.</p></dd>


<dt id="arg-time-var">time_var<a class="anchor" aria-label="anchor" href="#arg-time-var"></a></dt>
<dd><p>A string variable, specifying time units (e.g. "year", "time to treat", etc). Must be specified in terms of years (fractional years are accepted).</p></dd>


<dt id="arg-conf-var">conf_var<a class="anchor" aria-label="anchor" href="#arg-conf-var"></a></dt>
<dd><p>An unobserved confounding variable. Only used for the 'confound-method'.</p></dd>


<dt id="arg-effect-magnitude">effect_magnitude<a class="anchor" aria-label="anchor" href="#arg-effect-magnitude"></a></dt>
<dd><p>A vector of numerics, specifying 'true' effect sizes for treatment scenarios. See vignette for more details. Synthetic datasets will be generated for each entry in the vector.</p></dd>


<dt id="arg-n-units">n_units<a class="anchor" aria-label="anchor" href="#arg-n-units"></a></dt>
<dd><p>A numeric, determining number of units to simulate treatment effects. Synthetic datasets will be generated for each entry in the vector.</p></dd>


<dt id="arg-effect-direction">effect_direction<a class="anchor" aria-label="anchor" href="#arg-effect-direction"></a></dt>
<dd><p>A vector containing either 'neg', 'null', or 'pos'. Determines the direction of the simulated effect. Synthetic datasets will be generated for each entry in the vector.</p></dd>


<dt id="arg-policy-speed">policy_speed<a class="anchor" aria-label="anchor" href="#arg-policy-speed"></a></dt>
<dd><p>A vector of strings, containing either 'instant' or 'slow' entries, determining how quickly treated units obtain the simulated effect. Synthetic datasets will be generated for each entry in the vector. Can either be 'instant" (so treatment effect applies fully in the first treated time period) or 'slow' (treatment effect ramps up linearly to the desired effect size, based on `n_implementation_periods`.</p></dd>


<dt id="arg-prior-control">prior_control<a class="anchor" aria-label="anchor" href="#arg-prior-control"></a></dt>
<dd><p>Only used for confounding method. Adds an additional set of variables which control for the outcome in previous periods (either a moving average of previous time periods or an autoregressive term)</p></dd>


<dt id="arg-bias-size">bias_size<a class="anchor" aria-label="anchor" href="#arg-bias-size"></a></dt>
<dd><p>A string, either "small" "medium" or "large". Specifies relative size of bias for 'confounding' method.</p></dd>


<dt id="arg-bias-type">bias_type<a class="anchor" aria-label="anchor" href="#arg-bias-type"></a></dt>
<dd><p>A string, either linear" or "nonlinear". Specifies type of bias for 'confounding' method</p></dd>


<dt id="arg-treat-var">treat_var<a class="anchor" aria-label="anchor" href="#arg-treat-var"></a></dt>
<dd><p>A string variable, referring to the unit-of-analysis for treatment (which may not be the same as the unit var argument, e.g. treated classrooms within clustered schools)</p></dd>


<dt id="arg-n-implementation-periods">n_implementation_periods<a class="anchor" aria-label="anchor" href="#arg-n-implementation-periods"></a></dt>
<dd><p>A vector of numerics, determining number of periods after implementation until treated units reach the desired simulated treatment effect. Synthetic datasets will be generated for each entry in the vector.</p></dd>


<dt id="arg-rhos">rhos<a class="anchor" aria-label="anchor" href="#arg-rhos"></a></dt>
<dd><p>A vector of values between 0-1, indicating the correlation between the primary policy and a concurrent policy. Only applies when 'method' == 'concurrent'. Synthetic datasets will be generated for each entry in the vector.</p></dd>


<dt id="arg-years-apart">years_apart<a class="anchor" aria-label="anchor" href="#arg-years-apart"></a></dt>
<dd><p>A numeric, for number of years between the primary policy being implemented and the concurrent policy. Only applies when 'method' == 'concurrent'.</p></dd>


<dt id="arg-ordered">ordered<a class="anchor" aria-label="anchor" href="#arg-ordered"></a></dt>
<dd><p>A boolean, determines if the primary policy always occurs before the concurrent policy (`TRUE`) or if the policies are randomly ordered (`FALSE`).</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>A string, determing the simulation method. Can be either 'no_confounding', 'confounding' or 'concurrent'</p></dd>


<dt id="arg-method-sample">method_sample<a class="anchor" aria-label="anchor" href="#arg-method-sample"></a></dt>
<dd><p>Underlying function for the sampling method to determine treatment status. Provided here for convenience so that the user does not need to modify the actual underlying function's script.</p></dd>


<dt id="arg-method-model">method_model<a class="anchor" aria-label="anchor" href="#arg-method-model"></a></dt>
<dd><p>Another convenience function, which can be modified to control the model call.</p></dd>


<dt id="arg-method-results">method_results<a class="anchor" aria-label="anchor" href="#arg-method-results"></a></dt>
<dd><p>Another convenience function, which can be modified to control the simulation results that are returned.</p></dd>


<dt id="arg-method-pre-model">method_pre_model<a class="anchor" aria-label="anchor" href="#arg-method-pre-model"></a></dt>
<dd><p>Similar to method_sample argument, this variable is provided as a convenience for the user. This function transforms the treatment effect, after it's simulated within the synthetic data.</p></dd>


<dt id="arg-method-post-model">method_post_model<a class="anchor" aria-label="anchor" href="#arg-method-post-model"></a></dt>
<dd><p>Another convenience function, which can be modified to control transformations to the simulated effect, after modeling.</p></dd>


<dt id="arg-globals">globals<a class="anchor" aria-label="anchor" href="#arg-globals"></a></dt>
<dd><p>Additional globals to pass to the simulate function, such as parallelization packages or additional R packages used by method calls (e.g. modeling packages, like "FEOLS").</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Boolean, default True. If TRUE, provides summary details on simulation runs across iterations</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An OpticSim object, which contains simulation and model parameters for simulation runs, which is used as an input for dispatch_simulations.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The resulting configuration object is used to pass simulation scenarios to the 'simulate' function. Provided as a convenience function to the user
         so they can investigate simulation arguments prior to running models.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Load data for simulation and set up a hypothetical policy effect: </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">overdoses</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">eff</span> <span class="op">&lt;-</span> <span class="fl">0.1</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">overdoses</span><span class="op">$</span><span class="va">crude.rate</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Set up a simple linear model</span></span></span>
<span class="r-in"><span><span class="va">form</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></span><span class="op">(</span><span class="va">crude.rate</span> <span class="op">~</span> <span class="va">state</span> <span class="op">+</span> <span class="va">year</span> <span class="op">+</span> <span class="va">population</span> <span class="op">+</span> <span class="va">treatment_level</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="optic_model.html">optic_model</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'lin'</span>, </span></span>
<span class="r-in"><span>                   type <span class="op">=</span> <span class="st">'reg'</span>, </span></span>
<span class="r-in"><span>                   call <span class="op">=</span> <span class="st">'lm'</span>, </span></span>
<span class="r-in"><span>                   formula <span class="op">=</span> <span class="va">form</span>, </span></span>
<span class="r-in"><span>                   se_adjust <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create simulation object, with desired parameters for simulations:</span></span></span>
<span class="r-in"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu">optic_simulation</span><span class="op">(</span>x <span class="op">=</span> <span class="va">overdoses</span>, </span></span>
<span class="r-in"><span>                        models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                        method <span class="op">=</span> <span class="st">'no_confounding'</span>, </span></span>
<span class="r-in"><span>                        unit_var <span class="op">=</span> <span class="st">'state'</span>, </span></span>
<span class="r-in"><span>                        treat_var <span class="op">=</span> <span class="st">'state'</span>,</span></span>
<span class="r-in"><span>                        time_var <span class="op">=</span> <span class="st">'year'</span>, </span></span>
<span class="r-in"><span>                        effect_magnitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">eff</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                        n_units <span class="op">=</span> <span class="fl">10</span>, </span></span>
<span class="r-in"><span>                        effect_direction <span class="op">=</span> <span class="st">'pos'</span>, </span></span>
<span class="r-in"><span>                        iters <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>                        policy_speed <span class="op">=</span> <span class="st">'instant'</span>, </span></span>
<span class="r-in"><span>                        n_implementation_periods <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of Simulations: 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of Models: 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iteration per Simulation : 10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total number of Iterations to Run: 10</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Beth Ann Griffin, Pedro Nascimento de Lima, Max Griswold, Adam Scherling, Joseph Pane, Geoffrey Grimm.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

